<!DOCTYPE>
<html>

<head>
    <title>Chapter</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.3/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
</head>

<body>
    <div class="jumbotron text-center">
        <h1>Chapter</h1>
        <form method="get" action="/addchap">
            <button type="submit">thêm chap</button>
        </form>
        <hr>
        <h2>Danh sách chap</h2> <br>
        <form method="post" action="/search">
            <input type="text" name="mangaName" placeholder="Tìm kiếm theo tên truyện">
            <button type="submit">Search</button>
        </form>
        <table class="table table-bordered">
            <thead>
                <tr>
                    <th>manganame</th>
                    <th>number</th>
                    <th>viporfree</th>
                    <th>nút</th>
                </tr>
            </thead>

            <tbody>
                {{#each data}}
                <tr>
                    <td>{{this.mangaName}}</td>
                    <td>{{this.number}}</td>
                    <td>{{this.viporfree}}</td>
                    {{!-- <td>
                        <div style="display: flex; flex-wrap: wrap; justify-content: flex-start; ">
                            {{#each this.images}}
                            <div style=" width: calc(100% / 11);  margin: 5px;">
                                <img src="data:image/jpeg;base64,{{this}}" style="width: 100px; height: 100px;"
                                    loading="lazy">
                            </div>
                            {{/each}}
                        </div>
                    </td> --}}
                    <td>
                        <form action="/chapterput/{{_id}}" method="get">
                            <button type="submit">Edit</button>
                        </form>
                        <form action="/chapterdelete/{{this._id}}" onclick="return confirm('ban co muon xoa khong ?')"
                            method="post">
                            <button type="submit">Delete</button>
                        </form>
                        <button class="detail-button" data-chapter-id="{{this._id}}">Chi tiết</button>
                        <div id="image-modal" class="modal fade" role="dialog">
                            <div class="modal-dialog">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                                        <h4 class="modal-title">Danh sách ảnh chương</h4>
                                    </div>
                                    <div class="modal-body">
                                        
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-default" data-dismiss="modal">Đóng</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </td>
                </tr>
                {{/each}}
            </tbody>

        </table>
    </div>
    <script>
        $(document).ready(function () {
            $(".detail-button").on("click", function () {
                var chapterId = $(this).data("chapter-id");
                $.ajax({
                    type: "GET",
                    url: "/chapter/" + chapterId + "/images",
                    success: function (data) {
                        if (data.length > 0) {
                            var imagesHtml = data.map(function (image) {
                                return '<img src="data:image/jpeg;base64,' + image + '" style="width: 100px; height: 100px;" loading="lazy">';
                            }).join('');
                            $("#image-modal .modal-body").html(imagesHtml);
                            $("#image-modal").modal("show");
                        } else {
                            alert("Chưa có ảnh cho chương này.");
                        }
                    },
                    error: function (error) {
                        console.error("Lỗi khi lấy dữ liệu ảnh:", error);
                        alert("Đã xảy ra lỗi khi lấy dữ liệu ảnh.");
                    }
                });
            });
        });
    </script>
</body>

</html>