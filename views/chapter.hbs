<!DOCTYPE>
<html>

<head>
    <title>Chapter</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.3/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
</head>

<body>
    <div class="jumbotron text-center">
        <h1>Chapter</h1>
        <form method="get" action="/addchap">
            <button type="submit">thêm chap</button>
        </form>
        <hr>
        <h2>Danh sách chap</h2> <br>
        <form method="post" action="/search">
  <input type="text" name="mangaName" placeholder="Tìm kiếm theo tên truyện">
  <button type="submit">Search</button>
        </form>
        <table class="table table-bordered">
            <thead>
                <tr>
                    <th>manganame</th>
                    <th>number</th>
                    <th>viporfree</th>
                    <th>image</th>
                    <th>nút</th>
                </tr>
            </thead>

            <tbody>
                {{#each data}}
                <tr>
                    <td>{{this.mangaName}}</td>
                    <td>{{this.number}}</td>
                    <td>{{this.viporfree}}</td>
                    {{!-- <td>
                        <div style="display: flex; flex-wrap: wrap; justify-content: flex-start; ">
                            {{#each this.images}}
                            <div style=" width: calc(100% / 11);  margin: 5px;">
                                <img src="data:image/jpeg;base64,{{this}}" style="width: 100px; height: 100px;" loading="lazy">
                            </div>
                            {{/each}}
                        </div>
                    </td> --}}
                    <td>
                        <form action="/chapterput/{{_id}}" method="get">
                            <button type="submit">Edit</button>
                        </form>
                        <form action="/chapterdelete/{{this._id}}" onclick="return confirm('ban co muon xoa khong ?')"
                            method="post" >
                            <button type="submit" >Delete</button>
                        </form>
                        <button class="detail-button" data-chapter-id="{{this._id}}">Chi tiết</button>
                    </td>
                </tr>
                {{/each}}
            </tbody>

        </table>
    </div>
    <script>
    // Đoạn mã sẽ gửi yêu cầu lấy danh sách ảnh của chương theo ID khi nút "Chi tiết" được nhấn.
    document.querySelectorAll('.detail-button').forEach(button => {
        button.addEventListener('click', async () => {
            const chapterId = button.getAttribute('data-chapter-id');
            const response = await fetch(`/chapter/${chapterId}/images`);
            const data = await response.json();

            if (data.length > 0) {
                const imagesHtml = data.map(image => `<img src="data:image/jpeg;base64,${image}" style="width: 100px; height: 100px;" loading="lazy">`).join('');
                // Hiển thị ảnh chap trong một cửa sổ hoặc modal
                alert(imagesHtml); // Sử dụng alert() chỉ để minh họa, bạn có thể sử dụng cửa sổ modal hoặc thay đổi cách hiển thị ảnh theo mong muốn.
            } else {
                alert('Chưa có ảnh cho chương này.');
            }
        });
    });
</script>
</body>

</html>