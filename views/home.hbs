<!DOCTYPE html>
<html>

<head>
  <title>Comic</title>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.3/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
</head>

<body>
  <div class="jumbotron text-center">
    <h1>Comic</h1>
    <form method="get" action="/add">
      <button type="submit">thêm truyện</button>
    </form>
    <hr>
    <h2>Danh sách Truyện</h2>
    <table class="table table-bordered">
      <thead>
        <tr>
          <th>manganame</th>
          <th>image</th>
          <th>author</th>
          <th>content</th>
          <th>category </th>
          <th>view</th>
          <th>like</th>
          <th>nút</th>
        </tr>
      </thead>

      <tbody>
        {{#each manga}}
        <tr>
          <td>{{this.manganame}}</td>
          <td><img src="data:image/jpeg;base64,{{this.image}}" style="width: 100px;height: 100px;" loading="lazy"></td>
          <td>{{this.author}}</td>
          <td>{{this.content}}</td>
          <td>{{this.category}}</td>
          <td>{{this.view}}</td>
          <td>{{this.like}}</td>
          {{!-- <td>
            <button class="btn btn-info" onclick="showChapters('{{this.manganame}}')">Chi tiết</button>
          </td> --}}
          <td>
            {{!-- <form action="/edit/{{_id}}" method="get">
              <button type="submit">Edit</button>
            </form>
            <form action="/delete/{{this._id}}" onclick="return confirm('ban co muon xoa khong ?')" method="post">
              <button type="submit">Delete</button>
            </form> --}}
          </td>
        </tr>
        {{/each}}
      </tbody>

    </table>

  </div>
  <div class="modal fade" id="myModal" role="dialog">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal">&times;</button>
          <h4 class="modal-title">Danh sách Chap</h4>
        </div>
        <div class="modal-body">
          <ul class="list-group" id="chapList">
            <!-- Danh sách chap sẽ được thêm vào đây -->
          </ul>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">Đóng</button>
        </div>
      </div>
    </div>
  </div>

  <script>
   function showChapters(mangaName) {
  console.log("Tên manga:", mangaName);
  // Sử dụng Fetch API để gửi yêu cầu GET đến API
  // để lấy danh sách chap cho manga với tên được truyền vào (mangaName)
  fetch(`/mangas/${encodeURIComponent(mangaName)}/chapters`)
    .then((response) => response.json())
    .then((chapters) => {
      // Xử lý danh sách chap ở đây, ví dụ: hiển thị trong một modal popup
      displayChaptersModal(chapters);
    })
    .catch((error) => {
      console.error('Lỗi khi lấy danh sách chap:', error);
    });
}

function displayChaptersModal(chapters) {
  // Lấy ra phần danh sách chap trong modal
  const chapList = document.getElementById('chapList');
  chapList.innerHTML = ''; // Xóa nội dung danh sách cũ

  chapters.forEach((chapter) => {
    const chapItem = document.createElement('li');
    chapItem.textContent = `Chap ${chapter.number}`;
    chapItem.classList.add('list-group-item');
    chapList.appendChild(chapItem);
  });

  // Hiển thị modal
  $('#myModal').modal('show');
}
  </script>
</body>

</html>